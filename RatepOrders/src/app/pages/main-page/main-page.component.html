<div class="wrapper">
  <app-menu></app-menu>
  <section class="orders">
    <!-- Блок модификации вывода (фильтрация, поиск) -->
    <div class="result-modificators">
      <!-- Поиск -->
      <div class="input">
        <label for="search">Поиск</label>
        <input id="search"
               type="text"
               placeholder="Введите номер заказа, ФИО клиента, наименование или ИНН клиента..."
               [(ngModel)]="search">
      </div>

      <!-- Фильтрация -->
      <div class="filters">
        <div class="date-filters">
          <p>Дата заказа</p>
          <div class="date-filters-wrapper">

            <div class="input">
              <label for="orderStartDate">От</label>
              <input type="date"
                     id="orderStartDate"
                     [(ngModel)]="orderStartDate"
                     (focusout)="changeDate()">
            </div>

            <div class="input">
              <label for="orderEndDate">От</label>
              <input type="date"
                     id="orderEndDate"
                     [(ngModel)]="orderEndDate"
                     (focusout)="changeDate()">
            </div>

          </div>
        </div>
      </div>
    </div>

    <!-- Заказы -->
    <div class="order-list">
      <table>
        <thead>
          <th>Номер</th>
          <th>ИНН клиента</th>
          <th>Дата заказа</th>
          <th>Договор</th>
        </thead>
        <tbody>
          <ng-container *ngFor="let order of orders">

            <tr (mousedown)="orderActiveToggle(order)">
              <td>{{order.Number}}</td>
              <td>{{order.Tin}}</td>
              <td>{{order.OrderDate | date:'dd.MM.yyyy'}}</td>
              <td><a href="#"
                   class="contract-link">Скачать договор</a></td>
            </tr>
            <tr [ngClass]="{'hidden':!order.UI?.active}">
              <td colspan="4">
                <table>
                  <col style="width: auto;">
                  <col style="width: 100px;">
                  <col style="width: auto;">
                  <tbody>

                    <tr *ngFor="let position of getOrderPositions(order.OrderId)"
                        style="background: var(--selection-color);">
                      <td colspan="2">{{position.ProductName}}</td>
                      <td>{{position.Amount}}</td>
                      <td class="price">{{position.PriceValue | number: '1.2-2'}}</td>
                    </tr>
                  </tbody>
                </table>
                <span class="price sum">Сумма: {{getOrderSum(order.OrderId) | number: '1.2-2'}}</span>
              </td>
            </tr>
          </ng-container>
        </tbody>
      </table>

      <button class="create-order-button"
              (click)="createOrder()">Новый заказ</button>
    </div>
  </section>
</div>
